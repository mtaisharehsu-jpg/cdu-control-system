# CDUæ„Ÿæ¸¬å™¨APIæ–‡æª”

## æ¦‚è¿°

æœ¬æ–‡æª”æè¿°äº†CDUç³»çµ±ä¸­æ–°å¢çš„æ„Ÿæ¸¬å™¨è®€å–APIï¼Œèƒ½å¤ å¾PLCçš„Modbus TCPè®€å–å®Œæ•´çš„CDUæ„Ÿæ¸¬å™¨æ•¸æ“šï¼Œæ¶µè“‹å¤šæ©Ÿç¨®CDUè¨­å®šï¼Œä¸¦é€šéRedfish APIæä¾›æº«åº¦ã€æµé‡ã€å£“åŠ›ç­‰åƒæ•¸çš„æ©Ÿç¨®è¨­å®šåŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹æ€§

- âœ… **å¤šæ©Ÿç¨®æ”¯æ´**: æ¶µè“‹ä¸åŒCDUæ©Ÿç¨®çš„æ„Ÿæ¸¬å™¨é…ç½®
- âœ… **å®Œæ•´æ„Ÿæ¸¬å™¨è¦†è“‹**: æ”¯æ´æº«åº¦ã€æµé‡ã€å£“åŠ›ã€IOç­‰æ‰€æœ‰æ„Ÿæ¸¬å™¨é¡å‹
- âœ… **è‡ªå‹•æ•¸å€¼è½‰æ›**: è‡ªå‹•å°‡PLCåŸå§‹å€¼è½‰æ›ç‚ºå¯¦éš›å·¥ç¨‹å–®ä½
- âœ… **ç‹€æ…‹ç›£æ§**: å¯¦æ™‚ç›£æ§æ„Ÿæ¸¬å™¨ç‹€æ…‹å’Œå¥åº·åº¦
- âœ… **æ‰¹é‡è®€å–**: æ”¯æ´æ‰¹é‡è®€å–å¤šç¨®é¡å‹æ„Ÿæ¸¬å™¨
- âœ… **é ç•™ä½ç®¡ç†**: å¯é¸æ“‡æ˜¯å¦åŒ…å«é ç•™æ„Ÿæ¸¬å™¨

## æ„Ÿæ¸¬å™¨é¡å‹å®šç¾©

æ ¹æ“šæ‚¨æä¾›çš„è¦æ ¼ï¼Œå¯¦ç¾äº†4å¤§é¡æ„Ÿæ¸¬å™¨ï¼š

### 1. æµé‡è¨Šæ¯ (R10061-R10080)
| æ„Ÿæ¸¬å™¨åç¨± | æš«å­˜å™¨ | æè¿° | æ•¸æ“šç²¾åº¦ | æ•¸æ“šç¯„åœ | å–®ä½ |
|------------|--------|------|----------|----------|------|
| secondary_outlet_flow_f2 | R10062 | äºŒæ¬¡å´å‡ºæ°´é‡F2 | 1 | 0~700 (å°æ‡‰0~70LPM) | LPM |
| flow_reserved_* | R10061,R10063-R10080 | Fé ç•™ | - | - | - |

### 2. å£“åŠ›è¨Šæ¯ (R10081-R10110)
| æ„Ÿæ¸¬å™¨åç¨± | æš«å­˜å™¨ | æè¿° | æ•¸æ“šç²¾åº¦ | æ•¸æ“šç¯„åœ | å–®ä½ |
|------------|--------|------|----------|----------|------|
| secondary_inlet_pressure_p12 | R10082 | äºŒæ¬¡å´å…¥æ°´å£“åŠ›P12 | 0.01 | 5~600 (å°æ‡‰0.05~6bar) | bar |
| secondary_outlet_pressure_p13 | R10083 | äºŒæ¬¡å´å‡ºæ°´å£“åŠ›P13 | 0.01 | 5~600 (å°æ‡‰0.05~6bar) | bar |
| pressure_reserved_* | R10081,R10084-R10110 | Pé ç•™ | - | - | - |

### 3. æº«åº¦è¨Šæ¯ (R10111-R10140)
| æ„Ÿæ¸¬å™¨åç¨± | æš«å­˜å™¨ | æè¿° | æ•¸æ“šç²¾åº¦ | æ•¸æ“šç¯„åœ | å–®ä½ |
|------------|--------|------|----------|----------|------|
| secondary_return_temp_t11 | R10111 | äºŒæ¬¡å´å›æ°´æº«åº¦T11 | 0.1 | 100~800 (å°æ‡‰10~80â„ƒ) | â„ƒ |
| secondary_tank_temp_t12 | R10112 | äºŒæ¬¡å´æ°´ç®±æº«åº¦T12 | 0.1 | 100~800 (å°æ‡‰10~80â„ƒ) | â„ƒ |
| secondary_outlet_temp_t13 | R10113 | äºŒæ¬¡å´å‡ºæ°´æº«åº¦T13 | 0.1 | 100~800 (å°æ‡‰10~80â„ƒ) | â„ƒ |
| temp_reserved_* | R10114-R10140 | Té ç•™ | - | - | - |

### 4. è¼¸å…¥è¼¸å‡ºè¨Šæ¯ (R10141-R10159)
| æ„Ÿæ¸¬å™¨åç¨± | æš«å­˜å™¨ | æè¿° | æ•¸æ“šç¯„åœ | ç‹€æ…‹æ˜ å°„ |
|------------|--------|------|----------|----------|
| tank_level_switch_x17 | R10141 | äºŒæ¬¡å´æ°´ç®±æ¶²ä½é–‹é—œX17 | 0~1 | 0=æ­£å¸¸, 1=é«˜æ°´ä½ |
| leak_detection_x16 | R10143 | ç››æ°´ç›¤æ¼æ¶²åµæ¸¬X16 | 0~1 | 0=æ¼æ°´, 1=æ­£å¸¸ |
| water_pump_output_y17 | R10151 | è£œæ°´æ³µè¼¸å‡ºY17 | 0~1 | 0=å¾…æ©Ÿ, 1=å‹•ä½œ |

## APIç«¯é»

### 1. ç²å–æ‰€æœ‰æ„Ÿæ¸¬å™¨æ•¸æ“š

**ç«¯é»**: `GET /redfish/v1/Systems/CDU1/Oem/CDU/Sensors`

**åƒæ•¸**:
- `sensor_type` (å¯é¸): æ„Ÿæ¸¬å™¨é¡å‹ (temperature, pressure, flow, io)
- `sensor_name` (å¯é¸): ç‰¹å®šæ„Ÿæ¸¬å™¨åç¨±

**éŸ¿æ‡‰ç¯„ä¾‹**:
```json
{
  "success": true,
  "sensors_data": {
    "temperature": {
      "type_name": "æº«åº¦è¨Šæ¯",
      "sensors": {
        "secondary_return_temp_t11": {
          "register_address": 10111,
          "raw_value": 251,
          "actual_value": 25.1,
          "unit": "â„ƒ",
          "description": "äºŒæ¬¡å´å›æ°´æº«åº¦T11",
          "precision": 0.1,
          "range": "100~800 (å°æ‡‰10~80â„ƒ)",
          "status": "æ­£å¸¸",
          "is_active": true,
          "is_reserved": false
        }
      },
      "summary": {
        "count": 31,
        "active": 3,
        "errors": 28
      }
    }
  },
  "sensor_summary": {
    "total_sensors": 95,
    "active_sensors": 7,
    "error_sensors": 88,
    "sensor_types": {
      "temperature": {"count": 31, "active": 3, "errors": 28}
    }
  },
  "timestamp": "2025-07-21T12:00:18.673369"
}
```

### 2. POSTæ–¹å¼è®€å–æ„Ÿæ¸¬å™¨

**ç«¯é»**: `POST /redfish/v1/Systems/CDU1/Oem/CDU/Sensors/Read`

**è«‹æ±‚æ ¼å¼**:
```json
{
  "sensor_type": "temperature",
  "sensor_name": "secondary_return_temp_t11"  // å¯é¸
}
```

### 3. æ‰¹é‡è®€å–æ„Ÿæ¸¬å™¨

**ç«¯é»**: `POST /redfish/v1/Systems/CDU1/Oem/CDU/Sensors/BatchRead`

**è«‹æ±‚æ ¼å¼**:
```json
{
  "sensor_types": ["temperature", "pressure", "flow"],
  "include_reserved": false
}
```

## æ•¸å€¼è½‰æ›é‚è¼¯

### æº«åº¦æ„Ÿæ¸¬å™¨è½‰æ›
```
åŸå§‹å€¼ç¯„åœ: 100-800
å¯¦éš›å€¼ç¯„åœ: 10.0-80.0â„ƒ
è½‰æ›å…¬å¼: å¯¦éš›å€¼ = åŸå§‹å€¼ Ã— 0.1
ç¯„ä¾‹: 251 â†’ 25.1â„ƒ
```

### å£“åŠ›æ„Ÿæ¸¬å™¨è½‰æ›
```
åŸå§‹å€¼ç¯„åœ: 5-600
å¯¦éš›å€¼ç¯„åœ: 0.05-6.0 bar
è½‰æ›å…¬å¼: å¯¦éš›å€¼ = åŸå§‹å€¼ Ã— 0.01
ç¯„ä¾‹: 162 â†’ 1.62 bar
```

### æµé‡æ„Ÿæ¸¬å™¨è½‰æ›
```
åŸå§‹å€¼ç¯„åœ: 0-700
å¯¦éš›å€¼ç¯„åœ: 0-70 LPM
è½‰æ›å…¬å¼: å¯¦éš›å€¼ = åŸå§‹å€¼ Ã— 0.1
ç¯„ä¾‹: 0 â†’ 0.0 LPM
```

### IOæ„Ÿæ¸¬å™¨ç‹€æ…‹æ˜ å°„
```
æ¶²ä½é–‹é—œ: 0=æ­£å¸¸, 1=é«˜æ°´ä½
æ¼æ¶²åµæ¸¬: 0=æ¼æ°´, 1=æ­£å¸¸
è£œæ°´æ³µ: 0=å¾…æ©Ÿ, 1=å‹•ä½œ
```

## ä½¿ç”¨ç¯„ä¾‹

### Pythonç¯„ä¾‹

```python
import requests
import json

base_url = "http://localhost:8001/redfish/v1"

# 1. ç²å–æ‰€æœ‰æº«åº¦æ„Ÿæ¸¬å™¨
response = requests.get(f"{base_url}/Systems/CDU1/Oem/CDU/Sensors?sensor_type=temperature")
result = response.json()

for sensor_name, sensor_info in result['sensors_data']['temperature']['sensors'].items():
    if sensor_info['is_active']:
        print(f"{sensor_info['description']}: {sensor_info['actual_value']} {sensor_info['unit']}")

# 2. ç²å–ç‰¹å®šæ„Ÿæ¸¬å™¨
response = requests.get(
    f"{base_url}/Systems/CDU1/Oem/CDU/Sensors",
    params={"sensor_type": "temperature", "sensor_name": "secondary_return_temp_t11"}
)

# 3. æ‰¹é‡è®€å–é—œéµæ„Ÿæ¸¬å™¨
response = requests.post(
    f"{base_url}/Systems/CDU1/Oem/CDU/Sensors/BatchRead",
    json={
        "sensor_types": ["temperature", "pressure", "flow"],
        "include_reserved": False
    }
)

if response.status_code == 200:
    result = response.json()
    print(f"ç¸½æ„Ÿæ¸¬å™¨æ•¸: {result['batch_summary']['total_sensors']}")
    print(f"æ­£å¸¸æ„Ÿæ¸¬å™¨æ•¸: {result['batch_summary']['active_sensors']}")
```

### cURLç¯„ä¾‹

```bash
# ç²å–æ‰€æœ‰æ„Ÿæ¸¬å™¨æ•¸æ“š
curl -X GET http://localhost:8001/redfish/v1/Systems/CDU1/Oem/CDU/Sensors

# ç²å–æº«åº¦æ„Ÿæ¸¬å™¨
curl -X GET "http://localhost:8001/redfish/v1/Systems/CDU1/Oem/CDU/Sensors?sensor_type=temperature"

# æ‰¹é‡è®€å–
curl -X POST http://localhost:8001/redfish/v1/Systems/CDU1/Oem/CDU/Sensors/BatchRead \
  -H "Content-Type: application/json" \
  -d '{"sensor_types": ["temperature", "pressure"], "include_reserved": false}'
```

## æ¸¬è©¦çµæœ

### å¯¦éš›æ¸¬è©¦æ•¸æ“š
- **ç¸½æ„Ÿæ¸¬å™¨æ•¸é‡**: 95å€‹
- **æ­£å¸¸æ„Ÿæ¸¬å™¨æ•¸é‡**: 7å€‹
- **éŒ¯èª¤æ„Ÿæ¸¬å™¨æ•¸é‡**: 88å€‹

### å„é¡å‹æ„Ÿæ¸¬å™¨çµ±è¨ˆ
- **æµé‡è¨Šæ¯**: 20å€‹ (æ­£å¸¸:1, éŒ¯èª¤:19)
- **å£“åŠ›è¨Šæ¯**: 31å€‹ (æ­£å¸¸:2, éŒ¯èª¤:29)
- **æº«åº¦è¨Šæ¯**: 31å€‹ (æ­£å¸¸:3, éŒ¯èª¤:28)
- **è¼¸å…¥è¼¸å‡ºè¨Šæ¯**: 13å€‹ (æ­£å¸¸:1, éŒ¯èª¤:12)

### é—œéµæ„Ÿæ¸¬å™¨ç‹€æ…‹
- ğŸŸ¢ **å›æ°´æº«åº¦**: 25.1â„ƒ (æ­£å¸¸)
- ğŸŸ¢ **æ°´ç®±æº«åº¦**: 26.3â„ƒ (æ­£å¸¸)
- ğŸŸ¢ **å…¥æ°´å£“åŠ›**: 1.62 bar (æ­£å¸¸)
- ğŸŸ¢ **å‡ºæ°´æµé‡**: 0.0 LPM (æ­£å¸¸)
- ğŸ”´ **æ¶²ä½é–‹é—œ**: é«˜æ°´ä½

## å¤šæ©Ÿç¨®æ”¯æ´

### æ©Ÿç¨®é…ç½®ç®¡ç†
ç³»çµ±æ”¯æ´ä¸åŒCDUæ©Ÿç¨®çš„æ„Ÿæ¸¬å™¨é…ç½®ï¼š

```python
# æ©Ÿç¨®Aé…ç½®
machine_a_config = {
    "temperature_sensors": ["T11", "T12", "T13"],
    "pressure_sensors": ["P12", "P13"],
    "flow_sensors": ["F2"],
    "io_sensors": ["X17", "X16", "Y17"]
}

# æ©Ÿç¨®Bé…ç½®
machine_b_config = {
    "temperature_sensors": ["T11", "T12", "T13", "T14"],
    "pressure_sensors": ["P12", "P13", "P14"],
    "flow_sensors": ["F2", "F3"],
    "io_sensors": ["X17", "X16", "Y17", "Y18"]
}
```

### å‹•æ…‹æ„Ÿæ¸¬å™¨æ˜ å°„
ç³»çµ±å¯æ ¹æ“šæ©Ÿç¨®è‡ªå‹•èª¿æ•´æ„Ÿæ¸¬å™¨æ˜ å°„å’Œæ•¸å€¼è½‰æ›é‚è¼¯ã€‚

## æ‡‰ç”¨å ´æ™¯

### 1. å¯¦æ™‚ç›£æ§
- æº«åº¦ã€å£“åŠ›ã€æµé‡çš„å¯¦æ™‚ç›£æ§
- ç•°å¸¸ç‹€æ…‹å³æ™‚å‘Šè­¦
- ç³»çµ±é‹è¡Œåƒæ•¸é¡¯ç¤º

### 2. æ•¸æ“šåˆ†æ
- æ­·å²æ•¸æ“šè¶¨å‹¢åˆ†æ
- æ€§èƒ½æŒ‡æ¨™çµ±è¨ˆ
- æ•…éšœæ¨¡å¼åˆ†æ

### 3. è‡ªå‹•åŒ–æ§åˆ¶
- åŸºæ–¼æ„Ÿæ¸¬å™¨æ•¸æ“šçš„è‡ªå‹•æ§åˆ¶
- é–¾å€¼ç›£æ§å’Œå‘Šè­¦
- é é˜²æ€§ç¶­è­·

## æ³¨æ„äº‹é …

1. **PLCé€£æ¥**: éœ€è¦ç¢ºä¿PLCåœ¨192.168.3.39:502å¯é”
2. **æ•¸å€¼ç²¾åº¦**: ä¸åŒæ„Ÿæ¸¬å™¨æœ‰ä¸åŒçš„ç²¾åº¦è¨­å®š
3. **ç‹€æ…‹åˆ¤æ–·**: åŸºæ–¼å¯¦éš›å€¼ç¯„åœé€²è¡Œç‹€æ…‹åˆ¤æ–·
4. **é ç•™ä½**: å¯é¸æ“‡æ˜¯å¦åŒ…å«é ç•™æ„Ÿæ¸¬å™¨

## ç‰ˆæœ¬æ­·å²

- **v1.0** (2025-07-21): åˆå§‹ç‰ˆæœ¬ï¼Œæ”¯æ´å®Œæ•´çš„CDUæ„Ÿæ¸¬å™¨è®€å–åŠŸèƒ½
