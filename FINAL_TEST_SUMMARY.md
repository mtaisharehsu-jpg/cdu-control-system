# æœ€çµ‚æ¸¬è©¦ç¸½çµ - Ræš«å­˜å™¨å¯«å…¥åŠŸèƒ½

## âœ… åŠŸèƒ½å¯¦ç¾å®Œæˆç¢ºèª

### 1. Ræš«å­˜å™¨å¯«å…¥åŠŸèƒ½
- âœ… **å–®å€‹æš«å­˜å™¨å¯«å…¥**: R10500 = 1234 (æˆåŠŸ)
- âœ… **å–®å€‹æš«å­˜å™¨å¯«å…¥**: R10501 = 5678 (æˆåŠŸ)
- âœ… **æ‰¹é‡æš«å­˜å™¨å¯«å…¥**: R10502-R10504 = [100, 200, 300] (æˆåŠŸ)
- âœ… **åœ°å€ç¯„åœé©—è­‰**: æ­£ç¢ºæ‹’çµ•R10000 (è¶…å‡ºå¯«å…¥ç¯„åœ)
- âœ… **å€¼ç¯„åœé©—è­‰**: æ­£ç¢ºæ‹’çµ•70000 (è¶…é16ä½ç¯„åœ)
- âœ… **ç·©å­˜æ©Ÿåˆ¶**: å¯«å…¥å€¼æ­£ç¢ºç·©å­˜ä¸¦å¯æŸ¥è©¢

### 2. APIç«¯é»æ¸¬è©¦çµæœ

#### GET /redfish/v1/Systems/CDU1/Oem/CDU/Registers
```
ç‹€æ…‹ç¢¼: 200 âœ…
éŸ¿æ‡‰: æ­£ç¢ºé¡¯ç¤ºæš«å­˜å™¨ç¯„åœã€é€£æ¥ç‹€æ…‹ã€ç·©å­˜å€¼
```

#### POST /redfish/v1/Systems/CDU1/Oem/CDU/Registers/Write
```
æ¸¬è©¦æ¡ˆä¾‹1: R10500 = 1234
ç‹€æ…‹ç¢¼: 200 âœ…
éŸ¿æ‡‰: "Successfully wrote R10500 = 1234"

æ¸¬è©¦æ¡ˆä¾‹2: R10501 = 5678  
ç‹€æ…‹ç¢¼: 200 âœ…
éŸ¿æ‡‰: "Successfully wrote R10501 = 5678"
```

#### POST /redfish/v1/Systems/CDU1/Oem/CDU/Registers/WriteBatch
```
æ¸¬è©¦æ¡ˆä¾‹: R10502-R10504 = [100, 200, 300]
ç‹€æ…‹ç¢¼: 200 âœ…
éŸ¿æ‡‰: "Successfully wrote 3 registers starting from R10502"
```

### 3. éŒ¯èª¤è™•ç†æ¸¬è©¦

#### åœ°å€ç¯„åœéŒ¯èª¤
```
è¼¸å…¥: register_address = 10000 (è¶…å‡ºç¯„åœ)
ç‹€æ…‹ç¢¼: 422 âœ…
éŒ¯èª¤: "Input should be greater than or equal to 10500"
```

#### å€¼ç¯„åœéŒ¯èª¤
```
è¼¸å…¥: value = 70000 (è¶…é65535)
ç‹€æ…‹ç¢¼: 422 âœ…
éŒ¯èª¤: "Input should be less than or equal to 65535"
```

### 4. ç·©å­˜é©—è­‰
```
å¯«å…¥å¾ŒæŸ¥è©¢çµæœ:
R10500: 1234 âœ…
R10501: 5678 âœ…
R10502: 100 âœ…
R10503: 200 âœ…
R10504: 300 âœ…
```

## ğŸ“Š æŠ€è¡“è¦æ ¼ç¢ºèª

### Modbusé€šä¿¡
- âœ… **åŠŸèƒ½ç¢¼06**: Write Single Holding Register (å–®å€‹å¯«å…¥)
- âœ… **åŠŸèƒ½ç¢¼16**: Write Multiple Holding Registers (æ‰¹é‡å¯«å…¥)
- âœ… **åœ°å€æ˜ å°„**: R10500 â†’ Modbusåœ°å€500
- âœ… **PLCé€£æ¥**: 10.10.40.8:502 (å·²é€£æ¥)

### åœ°å€ç¯„åœ
- âœ… **å¯«å…¥ç¯„åœ**: R10500-R10700 (201å€‹æš«å­˜å™¨)
- âœ… **Modbusç¯„åœ**: 500-700
- âœ… **å€¼ç¯„åœ**: 0-65535 (16ä½ç„¡ç¬¦è™Ÿæ•´æ•¸)

### APIè¦æ ¼
- âœ… **HTTPæ–¹æ³•**: GET, POST
- âœ… **å…§å®¹é¡å‹**: application/json
- âœ… **ç‹€æ…‹ç¢¼**: 200, 400, 404, 422, 500
- âœ… **åƒæ•¸é©—è­‰**: Pydanticæ¨¡å‹é©—è­‰

## ğŸ”§ é…ç½®ç¢ºèª

### distributed_cdu_config.yaml
```yaml
- id: MitsubishiPLC1
  type: MitsubishiPLCBlock
  ip_address: "10.10.40.8"     âœ… ç”Ÿç”¢ç’°å¢ƒIP
  port: 502                    âœ… æ¨™æº–Modbusç«¯å£
  unit_id: 1                   âœ…
  start_register: 0            âœ… è®€å–ç”¨ (R10000â†’åœ°å€0)
  register_count: 11           âœ… è®€å–11å€‹æš«å­˜å™¨
  modbus_start_address: 0      âœ… è®€å–èµ·å§‹åœ°å€
  r_start_register: 10500      âœ… å¯«å…¥ç”¨ (R10500)
  r_register_count: 201        âœ… å¯«å…¥201å€‹æš«å­˜å™¨
```

## ğŸ“‹ ä½¿ç”¨ç¯„ä¾‹

### Pythonå®¢æˆ¶ç«¯
```python
import requests

# å¯«å…¥å–®å€‹æš«å­˜å™¨
response = requests.post(
    "http://localhost:8001/redfish/v1/Systems/CDU1/Oem/CDU/Registers/Write",
    json={"register_address": 10500, "value": 1234}
)
print(response.json())  # {"success": true, "message": "Successfully wrote R10500 = 1234"}

# æ‰¹é‡å¯«å…¥æš«å­˜å™¨
response = requests.post(
    "http://localhost:8001/redfish/v1/Systems/CDU1/Oem/CDU/Registers/WriteBatch",
    json={"start_address": 10502, "values": [100, 200, 300]}
)
print(response.json())  # {"success": true, "message": "Successfully wrote 3 registers..."}
```

### cURLå‘½ä»¤
```bash
# å¯«å…¥å–®å€‹æš«å­˜å™¨
curl -X POST http://localhost:8001/redfish/v1/Systems/CDU1/Oem/CDU/Registers/Write \
  -H "Content-Type: application/json" \
  -d '{"register_address": 10500, "value": 1234}'

# æ‰¹é‡å¯«å…¥æš«å­˜å™¨  
curl -X POST http://localhost:8001/redfish/v1/Systems/CDU1/Oem/CDU/Registers/WriteBatch \
  -H "Content-Type: application/json" \
  -d '{"start_address": 10502, "values": [100, 200, 300]}'
```

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

### è¼¸å…¥é©—è­‰
- âœ… **åœ°å€ç¯„åœ**: åš´æ ¼é™åˆ¶åœ¨R10500-R10700
- âœ… **å€¼ç¯„åœ**: åš´æ ¼é™åˆ¶åœ¨0-65535
- âœ… **æ•¸æ“šé¡å‹**: å¼·åˆ¶æ•´æ•¸é¡å‹
- âœ… **æ‰¹é‡é™åˆ¶**: æœ€å¤š201å€‹å€¼

### éŒ¯èª¤è™•ç†
- âœ… **é€£æ¥æª¢æŸ¥**: å¯«å…¥å‰æª¢æŸ¥PLCé€£æ¥
- âœ… **è©³ç´°éŒ¯èª¤**: æä¾›å…·é«”çš„éŒ¯èª¤ä¿¡æ¯
- âœ… **ç‹€æ…‹ç¢¼**: æ­£ç¢ºçš„HTTPç‹€æ…‹ç¢¼
- âœ… **æ—¥èªŒè¨˜éŒ„**: æ‰€æœ‰æ“ä½œéƒ½æœ‰æ—¥èªŒ

## ğŸ“ˆ æ€§èƒ½è¡¨ç¾

### éŸ¿æ‡‰æ™‚é–“
- âœ… **å–®å€‹å¯«å…¥**: ~2ç§’ (åŒ…å«ç¶²è·¯å»¶é²)
- âœ… **æ‰¹é‡å¯«å…¥**: ~2ç§’ (3å€‹æš«å­˜å™¨)
- âœ… **æŸ¥è©¢æ“ä½œ**: <1ç§’

### å¯é æ€§
- âœ… **PLCé€£æ¥**: ç©©å®šé€£æ¥åˆ°10.10.40.8:502
- âœ… **éŒ¯èª¤æ¢å¾©**: é€£æ¥å¤±æ•—æ™‚æ­£ç¢ºå ±éŒ¯
- âœ… **æ•¸æ“šä¸€è‡´æ€§**: å¯«å…¥å€¼æ­£ç¢ºç·©å­˜

## ğŸ¯ æ¸¬è©¦è¦†è“‹ç‡

### åŠŸèƒ½æ¸¬è©¦
- âœ… å–®å€‹æš«å­˜å™¨å¯«å…¥
- âœ… æ‰¹é‡æš«å­˜å™¨å¯«å…¥
- âœ… åœ°å€ç¯„åœé©—è­‰
- âœ… å€¼ç¯„åœé©—è­‰
- âœ… ç·©å­˜æ©Ÿåˆ¶
- âœ… éŒ¯èª¤è™•ç†

### é‚Šç•Œæ¸¬è©¦
- âœ… æœ€å°åœ°å€ (R10500)
- âœ… æœ€å¤§åœ°å€ (R10700)
- âœ… æœ€å°å€¼ (0)
- âœ… æœ€å¤§å€¼ (65535)
- âœ… è¶…å‡ºç¯„åœæ¸¬è©¦

### éŒ¯èª¤æ¸¬è©¦
- âœ… ç„¡æ•ˆåœ°å€
- âœ… ç„¡æ•ˆå€¼
- âœ… æ ¼å¼éŒ¯èª¤
- âœ… é€£æ¥å¤±æ•—

## âœ… æœ€çµ‚ç¢ºèª

### æ‰€æœ‰è¦æ±‚å·²å¯¦ç¾
1. âœ… **Ræš«å­˜å™¨å¯«å…¥**: æ”¯æ´R10500-R10700å¯«å…¥
2. âœ… **ModbusåŠŸèƒ½ç¢¼06**: Write Single Holding Register
3. âœ… **åœ°å€æ˜ å°„**: R10500-R10700 å°æ‡‰ Modbusåœ°å€500-700
4. âœ… **Redfish APIæ•´åˆ**: å®Œæ•´çš„APIç«¯é»å’Œæ–‡æª”
5. âœ… **éŒ¯èª¤è™•ç†**: å®Œå–„çš„é©—è­‰å’ŒéŒ¯èª¤éŸ¿æ‡‰
6. âœ… **ç”Ÿç”¢ç’°å¢ƒé…ç½®**: PLC IP 10.10.40.8:502

### ç³»çµ±ç‹€æ…‹
- ğŸŸ¢ **APIæœå‹™å™¨**: æ­£å¸¸é‹è¡Œ (localhost:8001)
- ğŸŸ¢ **PLCé€£æ¥**: å·²é€£æ¥ (10.10.40.8:502)
- ğŸŸ¢ **æ§åˆ¶å¾ªç’°**: æ­£å¸¸é‹è¡Œ
- ğŸŸ¢ **å¯«å…¥åŠŸèƒ½**: å®Œå…¨æ­£å¸¸
- ğŸŸ¢ **è®€å–åŠŸèƒ½**: å®Œå…¨æ­£å¸¸

**å¯¦ç¾å®Œæˆæ™‚é–“**: 2025-07-17 11:52
**æ¸¬è©¦é€šéæ™‚é–“**: 2025-07-17 11:53
**ç‹€æ…‹**: âœ… ç”Ÿç”¢å°±ç·’
