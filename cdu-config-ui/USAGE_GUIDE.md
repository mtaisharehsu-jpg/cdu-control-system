# CDU API UI 使用指南

## 🚀 快速啟動

### 1. 啟動後端API服務器

在主項目目錄中運行：

```bash
cd d:\group\prog\sysv01\N_cdu_dis_py_c_v001
python distributed_main_api.py
```

後端服務器將在 `http://localhost:8001` 運行

### 2. 啟動前端UI

在前端項目目錄中運行：

```bash
cd d:\group\prog\sysv01\N_cdu_dis_py_c_v001\cdu-config-ui
npm run dev
```

前端UI將在 `http://localhost:5173` 運行

### 3. 訪問UI界面

打開瀏覽器訪問: `http://localhost:5173`

## 📱 UI界面說明

### 主要功能頁面

1. **機種定義管理** - 管理不同CDU機種的配置 ⭐ 已完善
2. **當前系統狀態** - 查看CDU系統的實時狀態
3. **API測試工具** - 測試和驗證API功能

## 🔧 機種定義管理功能

### 功能概覽
機種定義管理頁面提供完整的CDU機種配置管理功能，包括：

#### 📊 統計概覽卡片
- **當前使用機種**: 顯示目前正在使用的機種
- **機種統計**: 總機種數、預定義機種數、自定義機種數
- **感測器使用情況**: 感測器使用率和狀態統計
- **系統指標**: 各項系統健康指標

#### 📋 機種列表管理
- **機種信息**: 顯示機種名稱、類型、描述、感測器數量、狀態
- **狀態指示**: 清楚標示當前使用的機種
- **快速切換**: 一鍵切換到其他機種
- **操作菜單**: 查看配置、編輯、導入/導出、刪除

#### ⚙️ 詳細配置管理
- **感測器配置查看**: 按類型查看所有感測器配置
- **配置編輯**: 編輯自定義機種的感測器配置
- **新增感測器**: 為機種添加新的感測器
- **參數設定**: 設定感測器的暫存器、描述、單位、精度等

#### 📥📤 導入/導出功能
- **配置導出**: 將機種配置導出為JSON文件
- **配置導入**: 從JSON文件導入機種配置
- **範例配置**: 提供標準配置範例
- **格式驗證**: 自動驗證導入配置的格式

### 使用步驟

#### 1. 查看機種概覽
- 進入"機種定義管理"頁面
- 查看統計概覽卡片了解系統狀態
- 檢視機種列表中的所有可用機種

#### 2. 切換機種
- 在機種列表中找到目標機種
- 點擊"設定"圖標切換到該機種
- 系統會自動更新當前機種狀態

#### 3. 查看機種配置
- 點擊機種操作菜單中的"查看配置"
- 瀏覽該機種的詳細感測器配置
- 查看各類型感測器的參數設定

#### 4. 創建新機種
- 點擊"新增機種"按鈕
- 填寫機種類型、名稱、描述
- 系統會自動創建基本的感測器配置

#### 5. 編輯機種配置
- 選擇自定義機種（預定義機種無法編輯）
- 點擊"查看配置"進入詳細配置頁面
- 編輯感測器參數或新增感測器

#### 6. 導入/導出配置
- 點擊操作菜單中的"導入/導出"
- **導出**: 下載當前機種配置為JSON文件
- **導入**: 上傳JSON配置文件創建新機種

#### 7. 刪除機種
- 選擇非當前使用的自定義機種
- 點擊"刪除"並確認操作
- 注意：預定義機種和當前使用機種無法刪除

### API測試工具使用

在左側導航欄點擊 "API測試工具" 進入測試頁面：

#### 基本API測試
- **獲取系統狀態**: 測試系統狀態API
- **獲取機種配置**: 測試機種配置管理API
- **獲取溫度感測器**: 測試感測器數據讀取API
- **獲取異常信息**: 測試異常信息API

#### 操作API測試
- **切換到緊湊型機種**: 測試機種切換功能
- **執行啟動操作**: 測試CDU操作控制

## 🔧 API端點說明

### 機種配置管理
- `GET /MachineConfig` - 獲取所有機種配置
- `POST /MachineConfig/Set` - 設定當前機種

### 系統監控
- `GET /Status` - 獲取系統狀態
- `GET /Sensors` - 獲取感測器數據
- `GET /IntegratedAlarms` - 獲取異常信息

### 操作控制
- `POST /Operations/Execute` - 執行操作命令

## 📊 測試結果說明

### 成功響應
- 顯示綠色的 ✅ 成功標記
- 顯示執行時間
- 可展開查看詳細響應數據

### 錯誤響應
- 顯示紅色的 ❌ 錯誤標記
- 顯示錯誤信息
- 顯示執行時間

### 常見錯誤
由於沒有實際的PLC連接，以下錯誤是正常的：
- `Failed to read R10000 register`
- `Connection to PLC failed`
- `Serial port COM7 not found`

## 🎯 功能特色

### 1. 實時API測試
- 點擊按鈕即可測試API功能
- 實時顯示請求結果
- 詳細的錯誤信息

### 2. 系統概覽
- 當前機種顯示
- 系統狀態監控
- 快速狀態檢查

### 3. 響應數據查看
- JSON格式的響應數據
- 可摺疊的數據展示
- 易於閱讀的格式化

### 4. 用戶友好界面
- Material-UI設計
- 響應式布局
- 直觀的操作流程

## 🔍 調試技巧

### 1. 檢查網路連接
確保前端能夠訪問後端API：
```bash
curl http://localhost:8001/redfish/v1/Systems/CDU1/Oem/CDU/Status
```

### 2. 查看瀏覽器控制台
按F12打開開發者工具，查看Console標籤中的錯誤信息。

### 3. 檢查CORS設定
如果出現CORS錯誤，確保後端API服務器配置了正確的CORS設定。

### 4. 驗證API端點
在瀏覽器中直接訪問API端點來驗證後端服務：
- http://localhost:8001/redfish/v1/Systems/CDU1/Oem/CDU/Status
- http://localhost:8001/redfish/v1/Systems/CDU1/Oem/CDU/MachineConfig

## 📝 開發說明

### 環境配置
前端使用 `.env` 文件配置API端點：
```env
VITE_API_BASE_URL=http://localhost:8001/redfish/v1/Systems/CDU1/Oem/CDU
VITE_DEBUG=true
```

### 技術棧
- **前端**: React + TypeScript + Material-UI + Vite
- **HTTP客戶端**: Axios
- **後端**: Python FastAPI + Redfish API

### 項目結構
```
cdu-config-ui/
├── src/
│   ├── api/                 # API通訊模組
│   ├── components/          # React組件
│   ├── features/           # 功能模組
│   └── App.tsx             # 主應用程式
├── .env                    # 環境配置
└── package.json           # 依賴管理
```

## 🚨 注意事項

1. **後端服務依賴**: 前端UI需要後端API服務器運行才能正常工作
2. **PLC連接**: 沒有實際PLC連接時，某些API會返回錯誤，這是正常現象
3. **端口衝突**: 確保8001和5173端口沒有被其他程序佔用
4. **瀏覽器兼容性**: 建議使用現代瀏覽器（Chrome、Firefox、Edge）

## 🔄 更新和維護

### 更新依賴
```bash
npm update
```

### 重新安裝依賴
```bash
npm install
```

### 清除緩存
```bash
npm run build
```

## 📞 支援

如果遇到問題：
1. 檢查控制台錯誤信息
2. 驗證API服務器狀態
3. 確認網路連接
4. 查看本文檔的調試技巧

---

**版本**: v1.0.0  
**更新日期**: 2025-07-21  
**開發者**: CDU系統開發團隊
