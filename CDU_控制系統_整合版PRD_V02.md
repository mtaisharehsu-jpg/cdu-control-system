# CDU 控制系統產品需求文檔 (PRD) - 整合精簡版
## 工業物聯網控制平台 v2.2

**文檔版本：** v2.1 - 整合版  
**創建日期：** 2025年7月28日  
**文檔語言：** 繁體中文  
**產品類型：** 工業物聯網控制平台  
**整合基礎：** CDU200KW實際操作手冊 + 系統架構設計文檔  

---

## 1. 執行摘要

### 1.1 產品概述
CDU 控制系統是一個基於四層架構的工業物聯網控制平台，專為200KW級冷卻劑分配單元 (Coolant Distribution Unit) 及其他工業設備的自動化控制而設計。系統整合了實際操作手冊中的用戶介面設計、硬體操作流程，以及分散式架構的企業級功能，提供即時監控、智能優化和全方位的安全管理。

### 1.2 核心價值主張
- **工業級可靠性：** 基於實際CDU200KW操作經驗，確保7x24小時穩定運行
- **直觀操作介面：** 整合觸控螢幕與Web界面，提供統一的用戶體驗
- **實時監控能力：** 每秒更新系統狀態，支援SNMP Trap即時警報
- **多層級安全管控：** 硬體TPM 2.0 + 軟體認證 + 操作審計追蹤
- **智能故障診斷：** 整合SNMP警報系統，提供詳細的故障排除指導

### 1.3 實際應用驗證
本PRD基於CDU200KW實際操作手冊，已驗證以下關鍵功能：
- 觸控螢幕 + Web瀏覽器雙介面操作
- 7個主要功能標籤頁 (Status, Alert Setting, Network Setting, System Setting, Control, FW Status, FW Update)
- 完整的SNMP Trap警報系統 (60+種警報類型)
- 多種運行模式 (Auto差壓控制/流量控制/溫度控制, Manual手動控制)
- 完整的維護與故障排除流程

---

## 2. 產品願景與目標

### 2.1 產品願景
基於實際工業應用經驗，打造最可靠、最易用的工業物聯網控制平台，讓複雜的工業設備控制變得簡單、智能且可預測。

### 2.2 戰略目標
**短期目標 (6個月內)：**
- 完成基於CDU200KW架構的標準化平台開發
- 實現生產環境穩定部署
- 建立標准操作和維護流程

**中期目標 (1年內)：**
- 擴展支援多種工業協議 (Modbus RTU/TCP, Ethernet/IP, CAN Bus)
- 實現AI優化算法集成
- 建立合作夥伴生態系統

**長期目標 (2年內)：**
- 成為工業IoT控制平台標準
- 實現邊緣-雲端混合架構
- 支援100+設備類型集成

---

## 3. 目標用戶和使用案例

### 3.1 主要用戶群體

#### 3.1.1 操作人員 (Operators)
**基於實際操作手冊場景**
- **需求**：簡單直觀的觸控螢幕操作
- **關鍵功能**：狀態監控、模式切換 (Auto/Manual/Stop)、即時警報處理
- **操作流程**：開機 → 檢查狀態 → 選擇運行模式 → 監控運行 → 安全關機

#### 3.1.2 維護技術人員 (Maintenance Technicians)  
**基於故障排除手冊**
- **需求**：詳細的故障診斷信息和處理指導
- **關鍵功能**：SNMP警報分析、日誌下載、韌體更新
- **操作工具**：Web界面、日誌檔案、診斷報告

#### 3.1.3 系統管理員 (System Administrators)
**基於網路和系統設定需求**
- **需求**：網路配置、用戶管理、系統維護
- **關鍵功能**：網路設定、SNMP配置、用戶權限管理、系統備份

### 3.2 主要使用案例

#### UC1: 日常運行監控
**基於Status標籤頁功能**
- 監控系統狀態圖示 (綠色正常/黃色警告/紅色警報)
- 查看感測器讀數 (溫度、壓力、流量、轉速)
- 監控泵浦與閥門運行狀態
- 處理警報和異常狀況

#### UC2: 自動模式操作
**基於Control標籤頁功能**
- 壓差控制：設定目標差壓 (50-150 KPA)
- 流量控制：設定目標流量 (10-200 LPM)  
- 溫度控制：設定目標溫度 (20-60°C)
- 液體溫度控制啟用/停用

#### UC3: 故障診斷與排除
**基於實際故障排除手冊**
- SNMP Trap警報處理 (60+種警報類型)
- 設備狀態檢查和更換指導
- 日誌分析和下載
- 系統重啟和恢復流程

---

## 4. 功能需求

### 4.1 用戶介面系統 (P0)

#### FR-UI-001: 雙介面支援
**用戶故事**：作為操作人員，我希望能同時使用觸控螢幕和Web瀏覽器操作系統，以便在不同場景下靈活使用。

**接受標準**：
- 支援CDU前面板觸控螢幕直接操作
- 支援通過Web瀏覽器遠端存取 (預設IP: 192.168.100.10)
- 兩種介面功能保持一致性
- Web介面需要用戶名密碼認證 (預設 admin/password)

#### FR-UI-002: 七大功能標籤頁
**用戶故事**：作為操作人員，我希望通過清晰的導航選單快速訪問不同功能，提高操作效率。

**接受標準**：
- Status標籤：顯示即時系統狀態和感測器數據  
- Alert Setting標籤：配置警報閾值和SNMP Trap設定
- Network Setting標籤：配置IPv4/IPv6網路和SNMP設定
- System Setting標籤：配置單位、冷卻液特性、密碼、日期時間
- Control標籤：控制運行模式和參數設定
- FW Status標籤：顯示韌體版本信息
- FW Update標籤：支援韌體升級功能

### 4.2 即時監控系統 (P0)

#### FR-MON-001: 即時狀態顯示
**基於Status標籤實際功能**

**接受標準**：
- 系統狀態每秒更新一次
- 狀態圖示：綠色(正常)/黃色(警告)/紅色(警報/錯誤)
- 支援以下感測器讀數：
  - 溫度感測器：From/To Server, From/To Facility (°C/°F)
  - 壓力感測器：各路壓力顯示 (MPa/psi)
  - 流量感測器：Server/Facility流量 (LPM/GPM)
  - 泵浦轉速：Left/Right RPM顯示
  - 閥門開度：Hex Valve/Bypass Valve百分比

#### FR-MON-002: 設備狀態監控
**基於實際硬體監控需求**

**接受標準**：
- 電源狀態：Power Left/Right (OK/Error)
- 泵浦狀態：Pump Left/Right (OK/Error) 
- 閥門狀態：Valve (OK/Error)
- 控制單元狀態：Control Unit Left/Right (OK/Running/Error)
- 感測器模組：Sensor Module (OK/Error)
- 洩漏檢測：Leak Detection (OK/Warning/Error)

### 4.3 運行模式控制 (P0)

#### FR-CTRL-001: 自動模式控制
**基於Control標籤實際功能**

**接受標準**：
- **壓差控制模式**：
  - 目標差壓設定範圍：50-150 KPA
  - 自動調節泵浦和閥門以維持目標差壓
- **流量控制模式**：
  - 目標流量設定範圍：10-200 LPM  
  - 自動調節泵浦以維持目標流量
- **溫度控制模式**：
  - 目標溫度設定範圍：20-60°C
  - 可啟用/停用液體溫度控制功能

#### FR-CTRL-002: 手動模式控制
**基於Manual模式實際操作**

**接受標準**：
- 泵浦負載設定：Left/Right 0-100%
- 閥門開度設定：HEX Valve 0-100%
- 支援所有泵浦統一設定功能
- 泵浦在10%以上開始運行，0%或低於10%時停止

### 4.4 警報管理系統 (P0)

#### FR-ALERT-001: SNMP Trap警報系統
**基於實際Alert Setting功能和故障排除手冊**

**接受標準**：
- 支援60+種SNMP Trap警報類型
- 警報分級：Warning (黃色) / Alert (紅色)
- 支援以下監控項目的閾值設定：
  - 溫度監控：Server/Facility進出口溫度
  - 壓力監控：Server/Facility進出口壓力和差壓
  - 流量監控：Server/Facility流量
  - 露點監控：Facility/Server露點 + X°C設定
- 設備狀態警報：電源、泵浦、閥門、控制單元、感測器異常
- 緊急停止功能：檢測到洩漏時自動停止泵浦

#### FR-ALERT-002: 警報處理和診斷
**基於故障排除手冊7.1和7.2章節**

**接受標準**：
- 每種警報提供詳細的使用者應對指導
- 支援警報歷史記錄和日誌下載
- 整合故障排除步驟和解決方案
- 支援警報確認和消除功能

### 4.5 網路和通訊 (P0)

#### FR-NET-001: 網路配置管理
**基於Network Setting實際功能**

**接受標準**：
- IPv4設定：支援DHCP或靜態IP配置
- IPv6設定：支援自動配置模式
- DNS設定：主要和次要DNS配置
- 主機名稱設定：支援ASCII字母數字，最大63字元
- 預設IP位址：192.168.100.10

#### FR-NET-002: SNMP通訊協議
**基於實際SNMP設定功能**

**接受標準**：
- 支援SNMP v1/v2c和v3協議
- SNMP v3安全等級：noAuthNoPriv / authNoPriv / authPriv
- 支援SHA/MD5認證和AES/DES加密
- 私有企業號碼：1.3.6.1.4.1.30628.1234
- 警告警報30秒發送一次，錯誤警報10秒發送一次

### 4.6 系統維護管理 (P1)

#### FR-MAINT-001: 韌體更新管理
**基於FW Update實際功能**

**接受標準**：
- 支援多模組韌體更新：Web I/F、Control Unit、Pump、Valve、Sensor Module
- 韌體掃描和版本檢查功能
- 更新前系統狀態檢查和警告
- 更新過程中系統安全性保護
- 支援更新失敗回滾機制

#### FR-MAINT-002: 日誌管理系統
**基於實際日誌功能**

**接受標準**：
- 支援多種日誌類型：
  - system_log.dat：系統狀態 (每15秒記錄)
  - trap_log.dat：SNMP Trap記錄
  - event_log.dat：系統設定變更記錄
  - control_log.dat：控制模式參數變更
  - apache_log：Web I/F存取日誌
- 日誌輪換：每週新建，保留2年
- 支援日誌下載和解密功能

---

## 5. 非功能需求

### 5.1 性能需求

#### NFR-P-001: 即時性能
- 控制迴路執行：<50ms per cycle
- 系統狀態更新：每秒1次更新頻率
- Web API回應：<100ms for 95% of requests
- 警報通知：從觸發到通知<1秒

#### NFR-P-002: 吞吐量
- 支援10,000+併發數據點
- 處理1,000+ API請求每分鐘
- 支援Modbus通訊100+交易每秒

### 5.2 可靠性需求

#### NFR-R-001: 可用性
- 99.99%正常運行時間
- 最大10秒計劃維護停機時間
- 分散式架構自動故障轉移<300ms

#### NFR-R-002: 數據完整性
- 節點故障轉移時零數據丟失
- 所有節點間通訊校驗和檢查
- 自動數據損壞檢測和恢復

### 5.3 安全需求

#### NFR-S-001: 認證授權
- 多因素認證支援
- 企業LDAP/Active Directory整合
- 會話超時和自動鎖定

#### NFR-S-002: 通訊加密
- 所有網路通訊使用TLS 1.3
- 存儲數據AES-256加密
- 硬體支援的密鑰存儲 (TPM 2.0)

---

## 6. 技術架構概述

### 6.1 四層架構設計

#### 第一層：硬體抽象層 (HAL)
- **技術**：C/C++共享庫
- **職責**：直接硬體通訊、協議實現
- **組件**：Modbus RTU/TCP、Ethernet/IP、CAN Bus、UART驅動程式

#### 第二層：控制引擎
- **技術**：Python與HAL的ctypes介面
- **職責**：功能塊執行、即時控制迴路
- **組件**：塊管理器、調度器、配置載入器

#### 第三層：應用服務
- **技術**：Python與FastAPI框架
- **職責**：業務邏輯、AI優化、集群協調
- **組件**：分散式引擎、AI優化器、安全管理器

#### 第四層：API和用戶介面
- **技術**：FastAPI (後端)、React/TypeScript (前端)
- **職責**：外部介面、用戶交互、系統管理
- **組件**：RESTful API、Web儀表板、行動介面

### 6.2 實際部署架構
**基於CDU200KW實際配置**
- **主控制器**：CDU主機含觸控螢幕
- **網路介面**：乙太網路連接埠支援Web存取
- **控制單元**：Left/Right Control Unit冗餘配置
- **電源系統**：Left/Right Power Unit冗餘供電
- **泵浦系統**：Left/Right Pump Unit負載均衡
- **感測系統**：溫度、壓力、流量、洩漏檢測感測器網路

---

## 7. 用戶故事

### Epic 1: 日常運行操作

#### US-OP-001: 系統啟動操作
**作為** 操作人員  
**我希望** 能夠安全可靠地啟動CDU系統  
**以便** 開始日常的冷卻液分配工作

**接受標準**：
- 檢查所有組件連接狀態
- 確認冷卻液液位充足
- 選擇運行模式 (自動差壓/流量/溫度控制 或 手動控制)
- 系統狀態確認後才能啟動泵浦
- 提供启动确认对话框防止误操作

#### US-OP-002: 即時狀態監控
**作為** 操作人員  
**我希望** 能夠即時查看系統運行狀態  
**以便** 及時發現和處理異常情況

**接受標準**：
- 儀表板每秒更新系統狀態
- 清晰的顏色編碼：綠色正常/黃色警告/紅色警報
- 顯示關鍵參數：溫度、壓力、流量、轉速
- 設備狀態指示：電源、泵浦、閥門、控制單元
- 支援觸控螢幕和Web瀏覽器雙介面查看

### Epic 2: 系統配置和維護

#### US-MAINT-001: 警報閾值配置
**作為** 維護技術人員  
**我希望** 能夠配置各種感測器的警報閾值  
**以便** 系統能夠及時預警潛在問題

**接受標準**：
- 支援溫度、壓力、流量、露點等參數閾值設定
- 提供視覺化的閾值設定介面 (彩色條狀圖)
- 支援Warning和Alert兩級警報設定
- 驗证设定值的合理性 (警報最小值 ≤ 警告最小值 < 警告最大值 ≤ 警報最大值)
- 設定變更後立即生效

#### US-MAINT-002: 故障診斷和排除
**作為** 維護技術人員  
**我希望** 在系統出現故障時獲得詳細的診斷信息和處理指導  
**以便** 快速恢復系統正常運行

**接受標準**：
- 每種SNMP警報提供詳細的故障描述
- 提供分步驟的故障排除指導
- 支援日誌檔案下載和分析
- 提供硬體更換指導和安全操作流程
- 記錄維護操作歷史

### Epic 3: 網路和安全管理

#### US-ADMIN-001: 網路配置管理
**作為** 系統管理員  
**我希望** 能夠配置CDU的網路設定  
**以便** 實現遠端監控和管理

**接受標準**：
- 支援IPv4 DHCP或靜態IP配置
- 支援IPv6自動配置
- 配置DNS服務器設定
- 設定SNMP通訊參數
- 網路設定變更後提供連接測試功能

#### US-ADMIN-002: 用戶權限管理
**作為** 系統管理員  
**我希望** 能夠管理不同用戶的系統存取權限  
**以便** 確保系統安全和操作合規

**接受標準**：
- 支援不同角色的用戶帳戶管理
- 提供用戶名密碼認證功能
- 支援會話超時和自動鎖定
- 記錄所有用戶操作的審計日誌
- 支援企業LDAP/Active Directory整合

---


## 結論

本整合版PRD基於CDU200KW實際操作手冊和企業級系統架構設計，提供了一個完整、可實施的工業物聯網控制平台產品需求規格。通過整合實際操作經驗和先進技術架構，本平台將為工業自動化領域帶來新的標準。

關鍵成功因素包括：
1. **實際驗證的功能設計**：基於真實操作手冊確保功能實用性
2. **用戶友好的介面設計**：觸控螢幕+Web雙介面滿足不同使用場景
3. **完整的警報和診斷系統**：60+種警報類型提供全面的系統監控
4. **可靠的維護和故障排除流程**：詳細的操作指導確保系統穩定運行
5. **企業級的安全和可擴展性**：分散式架構支援大規模部署

通過正確執行此路線圖，該平台將建立工業4.0時代工業控制系統的新標準。

---

**文檔版本**：v2.2 - 整合版  
**最後更新**：2025年7月28日  
**下次審查**：2025年8月28日  
**文檔擁有者**：產品管理團隊  
**批准者**：CTO、工程主管、產品主管